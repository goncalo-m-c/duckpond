<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>DuckPond - Notebooks</title>
        <link rel="stylesheet" href="/static/css/main.css?v=8" />
        <link rel="stylesheet" href="/static/css/components.css?v=1" />
        <link rel="stylesheet" href="/static/css/notebooks.css?v=8" />
        <link rel="stylesheet" href="/static/css/settings.css?v=8" />
    </head>
    <body>
        <div class="app-container">
            <!-- Header -->
            <header class="app-header" id="app-header">
                <div class="header-left">
                    <button
                        class="sidebar-toggle"
                        id="sidebar-toggle"
                        aria-label="Toggle sidebar"
                    >
                        <svg
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                        </svg>
                    </button>
                    <a href="/app" class="app-logo">
                        <span class="logo-icon">ðŸ¦†</span>
                        <span class="logo-text">DuckPond</span>
                    </a>
                    <div class="tenant-badge" id="tenant-badge">
                        <span class="tenant-name">Loading...</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="user-menu" id="user-menu">
                        <button
                            class="user-menu-button"
                            id="user-menu-button"
                            aria-expanded="false"
                            aria-haspopup="true"
                        >
                            <span class="user-avatar">
                                <svg
                                    width="20"
                                    height="20"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <path
                                        d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"
                                    ></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </span>
                            <span class="user-name" id="user-name">User</span>
                            <svg
                                class="dropdown-icon"
                                width="16"
                                height="16"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </button>
                        <div class="user-menu-dropdown" id="user-menu-dropdown">
                            <div class="menu-section">
                                <div class="menu-user-info">
                                    <div
                                        class="menu-user-name"
                                        id="menu-user-name"
                                    >
                                        User
                                    </div>
                                    <div
                                        class="menu-user-account"
                                        id="menu-user-account"
                                    >
                                        Account ID
                                    </div>
                                </div>
                            </div>
                            <div class="menu-divider"></div>
                            <div class="menu-section">
                                <a href="/app/settings" class="menu-item">
                                    <svg
                                        width="18"
                                        height="18"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                    >
                                        <circle cx="12" cy="12" r="3"></circle>
                                        <path
                                            d="M12 1v6m0 6v6m9-9h-6m-6 0H3m15.4-6.6l-4.2 4.2m-6.4 0l-4.2-4.2M19.6 19.6l-4.2-4.2m-6.4 0l-4.2 4.2"
                                        ></path>
                                    </svg>
                                    <span>Settings</span>
                                </a>
                                <a
                                    href="/docs"
                                    target="_blank"
                                    class="menu-item"
                                >
                                    <svg
                                        width="18"
                                        height="18"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                    >
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path
                                            d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"
                                        ></path>
                                        <line
                                            x1="12"
                                            y1="17"
                                            x2="12.01"
                                            y2="17"
                                        ></line>
                                    </svg>
                                    <span>Documentation</span>
                                </a>
                            </div>
                            <div class="menu-divider"></div>
                            <div class="menu-section">
                                <button class="menu-item" id="logout-button">
                                    <svg
                                        width="18"
                                        height="18"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                    >
                                        <path
                                            d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"
                                        ></path>
                                        <polyline
                                            points="16 17 21 12 16 7"
                                        ></polyline>
                                        <line
                                            x1="21"
                                            y1="12"
                                            x2="9"
                                            y2="12"
                                        ></line>
                                    </svg>
                                    <span>Logout</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <div class="app-body">
                <!-- Sidebar -->
                <aside class="app-sidebar" id="app-sidebar">
                    <nav class="sidebar-nav">
                        <a
                            href="/app/notebooks"
                            class="nav-item"
                            data-route="notebooks"
                        >
                            <svg
                                width="20"
                                height="20"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path
                                    d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"
                                ></path>
                                <path
                                    d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"
                                ></path>
                            </svg>
                            <span>Notebooks</span>
                        </a>
                        <a
                            href="/app/settings"
                            class="nav-item"
                            data-route="settings"
                        >
                            <svg
                                width="20"
                                height="20"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <circle cx="12" cy="12" r="3"></circle>
                                <path
                                    d="M12 1v6m0 6v6m9-9h-6m-6 0H3m15.4-6.6l-4.2 4.2m-6.4 0l-4.2-4.2M19.6 19.6l-4.2-4.2m-6.4 0l-4.2 4.2"
                                ></path>
                            </svg>
                            <span>Settings</span>
                        </a>
                    </nav>
                    <div class="sidebar-footer">
                        <a
                            href="/docs"
                            target="_blank"
                            class="nav-item nav-item-secondary"
                        >
                            <svg
                                width="20"
                                height="20"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <circle cx="12" cy="12" r="10"></circle>
                                <path
                                    d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"
                                ></path>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                            <span>Help & Docs</span>
                        </a>
                    </div>
                </aside>

                <!-- Main Content -->
                <main class="app-main" id="app-main">
                    <div class="content-container" id="content-container">
                        <!-- Content will be dynamically loaded here -->
                        <div class="loading-screen">
                            <div class="loading-spinner-large"></div>
                            <p>Loading...</p>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- Sidebar Overlay (for mobile) -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <!-- Scripts -->
        <script src="/static/js/auth.js?v=8"></script>
        <script src="/static/js/utils.js?v=9"></script>
        <script src="/static/js/components.js?v=1"></script>
        <script src="/static/js/api.js?v=8"></script>
        <script src="/static/js/views/notebooks.js?v=11"></script>
        <script src="/static/js/views/settings.js?v=8"></script>
        <script src="/static/js/app.js?v=8"></script>
        <script>
            // Initialize app
            document.addEventListener("DOMContentLoaded", async () => {
                const authManager = window.authManager;

                // Check authentication
                const isAuth = await authManager.requireAuth();
                if (!isAuth) return;

                // Get user info
                const user = authManager.getUser();
                if (user) {
                    document.getElementById("user-name").textContent =
                        user.name;
                    document.getElementById("menu-user-name").textContent =
                        user.name;
                    document.getElementById("menu-user-account").textContent =
                        user.account_id;
                    document
                        .getElementById("tenant-badge")
                        .querySelector(".tenant-name").textContent = user.name;
                }

                // User menu toggle
                const userMenuButton =
                    document.getElementById("user-menu-button");
                const userMenuDropdown =
                    document.getElementById("user-menu-dropdown");

                userMenuButton.addEventListener("click", (e) => {
                    e.stopPropagation();
                    const isExpanded =
                        userMenuButton.getAttribute("aria-expanded") === "true";
                    userMenuButton.setAttribute("aria-expanded", !isExpanded);
                    userMenuDropdown.classList.toggle("active");
                });

                // Close dropdown when clicking outside
                document.addEventListener("click", () => {
                    userMenuButton.setAttribute("aria-expanded", "false");
                    userMenuDropdown.classList.remove("active");
                });

                // Sidebar toggle
                const sidebarToggle = document.getElementById("sidebar-toggle");
                const sidebar = document.getElementById("app-sidebar");
                const sidebarOverlay =
                    document.getElementById("sidebar-overlay");

                sidebarToggle.addEventListener("click", () => {
                    sidebar.classList.toggle("open");
                    sidebarOverlay.classList.toggle("active");
                    document.body.classList.toggle("sidebar-open");
                });

                sidebarOverlay.addEventListener("click", () => {
                    sidebar.classList.remove("open");
                    sidebarOverlay.classList.remove("active");
                    document.body.classList.remove("sidebar-open");
                });

                // Logout
                document
                    .getElementById("logout-button")
                    .addEventListener("click", async () => {
                        await authManager.logout();
                        window.location.href = "/";
                    });

                // Navigation
                const navItems = document.querySelectorAll(
                    ".nav-item[data-route]",
                );
                navItems.forEach((item) => {
                    item.addEventListener("click", (e) => {
                        e.preventDefault();
                        navItems.forEach((nav) =>
                            nav.classList.remove("active"),
                        );
                        item.classList.add("active");

                        // Close mobile sidebar
                        if (window.innerWidth < 1024) {
                            sidebar.classList.remove("open");
                            sidebarOverlay.classList.remove("active");
                            document.body.classList.remove("sidebar-open");
                        }

                        // Route handling will be implemented in app.js
                        const route = item.getAttribute("data-route");
                        window.app?.navigate(route);
                    });
                });

                // Initialize app router
                if (window.app) {
                    window.app.init();
                }
            });
        </script>
    </body>
</html>
